
<html>
    <head>
      <title>Login with Account Kit</title>
      <script src="https://sdk.accountkit.com/en_EN/sdk.js"></script>
      <style>
        body { font-family: helvetica; }
      </style>
    </head>
    <body>
    <h2>Migrate from FB Account Kit to Twilio Verify</h1>
    <p>Facebook announced <a href="https://developers.facebook.com/blog/post/2019/09/09/account-kit-services-no-longer-available-starting-march">Account Kit deprecation</a> on September 9, 2019. This guide will show you how to replace Account Kit functionality with <a href="https://twilio.com/docs/verify/api">Twilio Verify</a></p>
    <div>
      <p>FB account kit SMS login:</p>
      <input value="+1" id="country_code" />
      <input placeholder="phone number" id="phone_number"/>
      <button onclick="smsLogin();">Login via SMS</button>
    </div>
    <div>
      <p><a href="https://twilio.com/docs/verify/api">Twilio Verify</a> SMS login:</p>
      <input value="+1" id="country_code" />
      <input placeholder="phone number" id="phone_number"/>
      <button onclick="smsLoginTwilio();">Login via SMS</button>
    </div>
    </body>
    <script>
      // initialize Account Kit with CSRF protection
      AccountKit_OnInteractive = function(){
        AccountKit.init(
          {
            appId:"{{FACEBOOK_APP_ID}}", 
            state:"{{csrf}}", 
            version:"{{ACCOUNT_KIT_API_VERSION}}",
            fbAppEventsEnabled:true,
            redirect:"{{REDIRECT_URL}}"
          }
        );
      };

      // login callback
      function loginCallback(response) {
        if (response.status === "PARTIALLY_AUTHENTICATED") {
          var code = response.code;
          var csrf = response.state;
          // Send code to server to exchange for access token
        }
        else if (response.status === "NOT_AUTHENTICATED") {
          // handle authentication failure
        }
        else if (response.status === "BAD_PARAMS") {
          // handle bad parameters
        }
      }

      // phone form submission handler
      function smsLogin() {
        var countryCode = document.getElementById("country_code").value;
        var phoneNumber = document.getElementById("phone_number").value;
        AccountKit.login(
          'PHONE', 
          {countryCode: countryCode, phoneNumber: phoneNumber}, // will use default values if not specified
          loginCallback
        );
      }

      function smsLoginTwilio() {
        console.log("sms login with Twilio triggered");
        var countryCode = document.getElementById("country_code").value;
        var phoneNumber = document.getElementById("phone_number").value;

        // deploy a backend server
        // Node.js: https://github.com/robinske/verify-server-node
        // Python:  https://github.com/robinske/verify-server
        // Golang:  https://github.com/robinske/go-verify-backend
        const formData = new FormData();
        formData.append("country_code", countryCode);
        formData.append("phone_number", phoneNumber);

        fetch("https://verify-v2-node.herokuapp.com/start", {
            method: 'POST',
            headers: {
              'Content-Type': 'application/x-www-form-urlencoded'
            },
            body: formData
          })
          .then(response => response.json())
          .then(json => console.log(json))
          .catch(error => console.log(error));
      }
    </script>
    </html>
    